---
- name: 시스템 패키지 캐시 업데이트
  apt:
    update_cache: yes
    cache_valid_time: 3600

- name: 필수 시스템 패키지 설치
  apt:
    name:
      - curl
      - wget
      - git
      - htop
      - jq
      - vim
      - open-iscsi
      - nfs-common
      - python3-apt
      - software-properties-common
      - qemu-guest-agent
    state: present

- name: 시간대 설정 (Asia/Seoul)
  timezone:
    name: Asia/Seoul

- name: QEMU Guest Agent 서비스 활성화 및 시작
  service:
    name: qemu-guest-agent
    state: started
    enabled: yes

- name: 프로비저닝 완료 후 Cloud-Init 비활성화 (재부팅 충돌 방지)
  file:
    path: /etc/cloud/cloud-init.disabled
    state: touch
    mode: '0644'